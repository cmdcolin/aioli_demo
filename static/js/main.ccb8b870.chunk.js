(this.webpackJsonptest1=this.webpackJsonptest1||[]).push([[0],{20:function(t,i,e){},37:function(t,i,e){"use strict";e.r(i);var s=e(0),a=e.n(s),n=e(15),h=e.n(n),o=(e(20),e(4)),r=e.n(o),c=e(6),l=e(2),f=e(7),u=e(10),d=e(11),b=1e4,v=function(){function t(i){Object(u.a)(this,t),this.rowNumber=i,this.padding=1,this.sizeLimit=1e6}return Object(d.a)(t,[{key:"log",value:function(t){console.log("r".concat(this.rowNumber,": ").concat(t))}},{key:"setAllFilled",value:function(t){this.allFilled=t}},{key:"getItemAt",value:function(t){if(this.allFilled)return this.allFilled;if(void 0!==this.min&&!(t<this.min)&&!(t>=this.max)){var i=t-this.offset;return this.bits[i]}}},{key:"isRangeClear",value:function(t,i){if(this.allFilled)return!1;if(void 0===this.min)return!0;if(i<=this.min||t>=this.max)return!0;for(var e=Math.min(this.max,i),s=Math.max(this.min,t);s<i&&s<e;s+=1)if(this.getItemAt(s))return!1;return!0}},{key:"initialize",value:function(t,i){var e=i-t;this.offset=t-e,this.min=t,this.max=i,this.bits=new Array(i-t+2*e)}},{key:"addRect",value:function(t,i){var e=t.l,s=t.r+this.padding;if(void 0===this.min)this.initialize(e,s);else{var a=this.bits.length;if(s-this.offset>=this.bits.length){var n=s-this.offset-this.bits.length+1+this.bits.length;this.bits.length+n>this.sizeLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.initialize(e,s)):n>0&&(this.bits=this.bits.concat(new Array(n)))}if(e<this.offset){var h=this.offset-e+a;this.bits.length+h>this.sizeLimit?(console.warn("Layout width limit exceeded, discarding old layout. Please be more careful about discarding unused blocks."),this.initialize(e,s)):(this.bits=new Array(h).concat(this.bits),this.offset-=h)}}var o=e-this.offset,r=s-this.offset;r-o>2e4&&console.warn("Layout X pitch set too low, feature spans ".concat(r-o," bits in a single row."),t,i);for(var c=o;c<r;c+=1)this.bits[c]=i;e<this.min&&(this.min=e),s>this.max&&(this.max=s)}},{key:"discardRange",value:function(t,i){if(!this.allFilled&&this.bits&&!(i<=this.min||t>=this.max)){if(t<=this.min&&i>=this.max)return this.min=void 0,this.max=void 0,this.bits=void 0,void(this.offset=void 0);if(i>this.min&&t<=this.min&&(this.min=i),t<this.max&&i>=this.max&&(this.max=t),this.offset<this.min-b&&this.bits.length>this.max+b-this.offset){var e=this.min-this.offset,s=this.bits.length-1-(this.max-this.offset);this.bits=this.bits.slice(e,this.bits.length-s),this.offset+=e}else if(this.offset<this.min-b){var a=this.min-Math.floor(5e3)-this.offset;this.bits.splice(0,a),this.offset+=a}else if(this.bits.length>this.max-this.offset+b){var n=this.max-this.offset+1+Math.floor(5e3);this.bits.length=n}for(var h=Math.max(this.min,t)-this.offset,o=Math.min(i,this.max)-this.offset,r=h;r>=0&&r<o;r+=1)this.bits[r]=void 0}}}]),t}(),m=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(u.a)(this,t),this.pitchX=i.pitchX||5,this.pitchY=i.pitchY||3,this.displayMode=i.displayMode,"compact"===this.displayMode&&(this.pitchY=Math.round(this.pitchY/4)||1,this.pitchX=Math.round(this.pitchX/4)||1),this.bitmap=[],this.rectangles={},this.maxHeight=Math.ceil((i.maxHeight||1/0)/this.pitchY),this.pTotalHeight=0}return Object(d.a)(t,[{key:"addRect",value:function(t,i,e,s,a){if(t in this.rectangles){var n=this.rectangles[t];return null===n.top?null:(this._addRectToBitmap(n,a),n.top*this.pitchY)}var h=Math.floor(i/this.pitchX),o=Math.floor(e/this.pitchX),r=Math.ceil(s/this.pitchY),c={id:t,l:h,r:o,mX:Math.floor((h+o)/2),h:r};a&&(c.data=a);for(var l=this.maxHeight-r,f=0;f<=l&&this._collides(c,f);f+=1);return f>l?(c.top=f=null,this.rectangles[t]=c,this.pTotalHeight=Math.max(this.pTotalHeight||0,f+r),null):(c.top=f,this._addRectToBitmap(c,a),this.rectangles[t]=c,this.pTotalHeight=Math.max(this.pTotalHeight||0,f+r),f*this.pitchY)}},{key:"_collides",value:function(t,i){if("collapsed"===this.displayMode)return!1;for(var e=this.bitmap,s=i+t.h,a=i;a<s;a+=1){var n=e[a];if(n&&!n.isRangeClear(t.l,t.r))return!0}return!1}},{key:"_autovivifyRow",value:function(t,i){var e=t[i];return e||(e=new v(i),t[i]=e),e}},{key:"_addRectToBitmap",value:function(t,i){if(null!==t.top){i=i||!0;var e=this.bitmap,s=this._autovivifyRow,a=t.top+t.h;if(t.r-t.l>2e4)for(var n=t.top;n<a;n+=1)s(e,n).setAllFilled(i);else for(var h=t.top;h<a;h+=1)s(e,h).addRect(t,i)}}},{key:"discardRange",value:function(t,i){for(var e=Math.floor(t/this.pitchX),s=Math.floor(i/this.pitchX),a=this.bitmap,n=0;n<a.length;n+=1){var h=a[n];h&&h.discardRange(e,s)}}},{key:"hasSeen",value:function(t){return!!this.rectangles[t]}},{key:"getByCoord",value:function(t,i){var e=Math.floor(i/this.pitchY),s=this.bitmap[e];if(s){var a=Math.floor(t/this.pitchX);return s.getItemAt(a)}}},{key:"getByID",value:function(t){var i=this.rectangles[t];if(i)return i.data||!0}},{key:"cleanup",value:function(){}},{key:"getTotalHeight",value:function(){return this.pTotalHeight*this.pitchY}}]),t}(),p=e(5),g=e(1);var j=1800;var x=function(){var t=Object(s.useRef)(),i=Object(p.c)({loc:Object(p.d)(p.b,"ctgA:1-10000"),file:Object(p.d)(p.b,"volvox-sorted.bam")}),e=Object(l.a)(i,2),a=e[0],n=e[1],h=Object(s.useState)(),o=Object(l.a)(h,2),u=o[0],d=o[1],b=Object(s.useState)(),v=Object(l.a)(b,2),x=v[0],O=v[1],y=Object(s.useState)(),w=Object(l.a)(y,2),k=w[0],M=w[1],R=Object(s.useState)(a.file),S=Object(l.a)(R,2),A=S[0],F=S[1],H=Object(s.useState)(a.loc),T=Object(l.a)(H,2),X=T[0],L=T[1],C=function(){var t=Object(s.useState)(0),i=Object(l.a)(t,2)[1];return Object(s.useCallback)((function(){i((function(t){return t+1}))}),[])}();return Object(s.useEffect)((function(){Object(c.a)(r.a.mark((function t(){var i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new f.Aioli("samtools/1.10"),t.next=3,i.init();case 3:O(i);case 4:case"end":return t.stop()}}),t)})))()}),[]),Object(s.useEffect)((function(){Object(c.a)(r.a.mark((function t(){var i,e;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!x){t.next=8;break}return i=new URL(a.file,window.location),t.next=4,f.Aioli.mount("".concat(i));case 4:return e=t.sent,t.next=7,f.Aioli.mount("".concat(i,".bai"));case 7:M(e);case 8:case"end":return t.stop()}}),t)})))()}),[a.file,x]),Object(s.useEffect)((function(){Object(c.a)(r.a.mark((function t(){var i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!k||!x){t.next=5;break}return t.next=3,x.exec("view -q 20 ".concat(k.path," ").concat(a.loc));case 3:i=t.sent,d(i);case 5:case"end":return t.stop()}}),t)})))()}),[k,a.loc,x]),Object(s.useEffect)((function(){var i=t.current.getContext("2d");i.clearRect(0,0,j,1e3);var e=function(t){var i=t.split(":"),e=Object(l.a)(i,2),s=e[0],a=e[1].split("-"),n=Object(l.a)(a,2);return{refId:+s-1,start:+n[0],end:+n[1]}}(a.loc),s=e.start,n=e.end,h=j/(n-s),o=new m;if(u){var r=null===u||void 0===u?void 0:u.stdout.split("\n");console.log({rows:r}),r.forEach((function(t,e){for(var a=t.split("\t"),n=Object(l.a)(a,6),r=n[1],c=n[3],f=n[5],u=+c,d=+r,b=(f||"").split(/([MIDNSHPX=])/),v=0,m=0;m<b.length;m+=2){var p=+b[m],g=b[m+1];"I"!==g&&"S"!==g&&"H"!==g&&(v+=p)}i.fillStyle=16&d?"#f99":"#99f";var j=u+v,x=(u-s)*h,O=(j-u)*h,y=o.addRect(e,u,j,10);i.fillRect(x,y,O,10)}))}}),[u,a.loc]),Object(g.jsxs)("div",{children:[Object(g.jsx)("p",{children:"Enter a BAM file URL:"}),Object(g.jsxs)("form",{onSubmit:function(t){n({file:A,loc:X}),M(void 0),C(),t.preventDefault()},children:[Object(g.jsx)("label",{htmlFor:"url"}),Object(g.jsx)("input",{id:"url",type:"text",value:A,onChange:function(t){return F(t.target.value)}}),Object(g.jsx)("label",{htmlFor:"loc"}),Object(g.jsx)("input",{id:"loc",type:"text",value:X,onChange:function(t){return L(t.target.value)}}),Object(g.jsx)("button",{type:"submit",children:"Submit"})]}),u?null:"Loading...",Object(g.jsx)("canvas",{ref:t,width:j,height:1e3})]})},O=function(t){t&&t instanceof Function&&e.e(3).then(e.bind(null,38)).then((function(i){var e=i.getCLS,s=i.getFID,a=i.getFCP,n=i.getLCP,h=i.getTTFB;e(t),s(t),a(t),n(t),h(t)}))};h.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(p.a,{children:Object(g.jsx)(x,{})})}),document.getElementById("root")),O()}},[[37,1,2]]]);
//# sourceMappingURL=main.ccb8b870.chunk.js.map